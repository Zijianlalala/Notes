# 计算机网络之运输层

## UDP

### 特点
* 无连接
* 支持一对一、一对多、多对一、多对多的交互通信
* 尽最大努力交付
* 面向报文

## TCP

### TCP报文的首部格式
前20字节是固定的，最大长度60字节
* 源端口和目的端口
* 序号 使用mol 2的32次方运算 指本报文段所发送数据的第一个字节的序号
* 确认号 所希望收到下一个报文段的第一个数据字节的序号
* 数据偏移 间接反映首部长度
* 窗口 即自己的接受窗口
### 概述
#### 特点
* 面向连接的运输层协议
* 每条TCP连接只能是点对点（一对一）	
* 可靠交付
* 提供全双工通信
* 面向字节流

#### TCP连接
TCP连接的端点叫套接字
套接字 = {IP地址：端口号}
### 可靠传输的工作原理
#### 停止等待协议
发送一个分组就停下来等待对方确认
#### 连续ARQ协议
可连续发送多个分组
* 发送分每收到一个确认，就把发送窗口向前滑动一个分组的位置
* 采用累积确认，对按序到达的最后一个分组发送确认
### TCP可靠传输的实现

#### 以字节为单位的滑动窗口
#### 超时重传时间的选择
RTT报文段往返时间 从发出到收到确认的时间
RTTs加权平均往返时间
RTTs初值为RTT
**RTTs = (1-α) * RTTs + α * 新RTT样本      α=0.125**
RTTD是RTT的**偏差**的加权平均值
RTTD初值为 RTT/2
**RTTD = （1-β）* RTTD + β * |RTTs - RTT|      β=0.25**
RTO超时重传时间
**RTO = RTTs + 4 * RTTD**
当报文重传时不采用其往返时间样本
#### 选择确认SACK	

### TCP流量控制
通过**滑动窗口rwnd**控制
让发送方的发送速度不要太快，要让接收方来得及接收
**端到端的问题**

### TCP拥塞控制	
通过**拥塞窗口cwnd**控制
防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。
**全局性的过程**

#### 慢开始  
cwnd = 2的N次方 N是当前轮次 
慢开始门限 ssthresh
cwnd < ssthresh时 使用慢开始算法
cwnd > ssthresh时 使用拥塞避免算法
相等时 都行
#### 拥塞避免
每经过一个轮次 cwnd+1
无论是慢开始阶段还是拥塞避免阶段，只要出现拥塞，就把ssthresh=cwnd/2，cwnd=1 （**乘法减小**：ssthresh = cwnd/2）
#### 快重传
要求接受方每收到一个**失序的报文段**后就立即发出重复确认
发送方只要连续收到三个重复确认就应当立即重传未收到报文段
#### 快恢复
当发送方连续收到三个重复确认，执行“乘法减小”，另cwnd = ssthresh，执行拥塞避免算法
#### 随机早期检测RED
**网络层协议**
避免网络中的全局同步现象
随机丢弃报文
THmax = 2 * THmin
Lav = (1-β) * Lav + β * 当前的队列样本长度
pt = pmax * (Lav - THmin) / (THmax - Lav)
p = pt / (1 - count * pt) //count代表队列当中的分组数
### TCP的运输连接管理