# 计算机网络之数据链路层
## 点对点信道
### 基本概念
* 链路
从一个结点到相邻结点的一段物理线路
* 数据链路
链路+实现通信协议的软硬件（实现这些协议的常用方法是使用**网络适配器**）
* 帧
协议数据单元
* 规程 

### PPP协议的组成
* 一个将IP数据报封装到串行链路的方法
* 链路控制协议LCP 用来建立、配置和测试数据链路连接
* 网络控制协议NCP

### PPP帧格式
#### 首部
* F（标志字段 Flag）0x7E 定界符 1字节
* A (地址字段 ) 0xFF 1字节
* C (控制字段) 0x03 1字节
* 协议 表示信息部分所属的协议 2字节

#### 信息部分
不超过1500字节
#### 尾部
* FCS
* F

### 实现透明传输
#### 字节填充
转义符定义为0x7D
1. 每一个0x7E转变成0x7D，0x5E
2. 若出现0x7D则转变为0x7D，0x5D
#### 零比特填充
只要发现连续5个1，则立即填入1个0
## 广播信道
### 局域网
网络为一个单位所拥有，且地理范围和站点书目均有限
#### 优点
* 具有广播功能
* 便于系统的扩展和逐渐地演变，各设备位置可灵活调整和改变
* 提高了系统的可靠性

#### 媒体共享技术
##### 静态划分信道
* 频分复用
* 时分复用
* 波分复用
* 码分复用

##### 动态媒体接入控制
* 随机接入
* 受控接入 （轮询）
#### 以太网标准
* DIX Ethernet V2
* IEEE 802.3

#### 适配器的作用
计算机的硬件地址就在适配器的ROM中
1. 进行数据串行传输和并行数据传输的转换
2. 对数据进行缓存
3. 管理适配器的设备驱动程序安装在OS中
4. 实现以太网协议
### CSMA/CD协议
载波监听多点接入/碰撞检测
#### 为了通信简便
1. 采用无连接的通信方式
2. 所以数据采用曼彻斯特编码的信号

#### 多点接入
总线型网络

#### 载波监听
检测信道。每个站都必须不停地检测信道

#### 碰撞检测
* 边发送边监听
* **电磁波在1KM电缆的传播时延约为5μs**
* **单程端到端传播时延成为τ**
* **争用期/碰撞窗口/基本退避时间为2τ**
对于10Mb/s以太网 争用期是512比特时间
* 最短帧长64字节 512比特
* 帧间最小间隔为9.6μs

#### 要点归纳
1. 准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部，组成以太网帧，放入适配器的缓存中。但在发送之前必须检测信道。
2. 检测信道：若检测到信道忙，则应不停地检测，一直等待信道转为空闲。若检测信道空闲，并在96比特时间内信道保持空闲，就发送这个帧。
3. 在发送过程中仍不停地检测信道，即网络适配器要边发送边监听。这里有两种可能
* 发送成功：在争用期内一直未检测到碰撞。这个帧肯定发送成功。然后回到1
* 发送失败：在争用期内检测到碰撞。这里立即停止发送数据，并按规定发送认为干扰信号。适配器接着执行指数退避算法，等待r倍512比特时间后，返回到2继续检测信道。但若重传达16次仍不能成功，则停止重传而向上报错。

### 使用广播信道的以太网
10BASE-T 10Mb/s的数据率 连接线上的信号是基带信号 双绞线
每个站到集线器的距离不超过100m

#### 集线器的特点
1. 物理上是星型网络，使用集线器的以太网在逻辑上仍是总线型
2. 一个集线器有多个接口
3. 集线器工作在物理层
4. 专门芯片进行自适应串音回波抵消

#### 以太网信道利用率
a = τ / To

#### 以太网的MAC层
硬件地址/物理地址/MAC地址
48位的全球地址：局域网上的每一台计算机中固化在适配器的ROM中的地址

##### MAC帧的格式
因为使用曼彻斯特编码所以不需要帧长度
* 目的地址 6字节
* 原地址 6字节
* 类型 2字节
* 数据 46~1500
* FCS 4字节
* 向下传到物理层时还要在帧的前面插入8字节 前七字节为前同步码 然后是帧开始定界符（为了接收端迅速实现未同步）
### 扩展以太网
#### 物理层

#### 数据链路层

## 基本问题
### 封装成帧
在一段数据前后分别添加首部和尾部。方便接受处理数据部分
### 透明传输
让数据部分透明，即能够正确读出来尾部，而不造成读错尾部导致数据出错
* 字符/字节填充
### 差错检测
循环冗余检测CRC
带传送数据M 长度为k
除数P 长度为n+1
1. 在M后添加n个0
2. 得到的(k+n)的数除以P得余数R(n位)
3. 余数R作为冗余码拼接在M后面发送出去（余数R又称为帧检测序列FCS）
#### 传输差错
* 比特差错
* 传输差错 ：帧丢失、帧重复、帧失序
